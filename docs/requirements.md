# 📄 リアルタイム翻訳・字幕システム 統合仕様書

## 🎯 目的

配信者（ストリーマー）向けに、音声認識結果およびチャットコメントをリアルタイムで翻訳し、OBS 上に字幕として表示するアプリケーションの構築。
AIを使用した翻訳を実現しつつ、**Electron Forge + Vite + React** によるモダンな構成で「リッチなゲーミング UI」と「高いメンテナンス性」を提供する。

---

## 🛠 I. バックエンド (Node.js/TypeScript) 仕様

| カテゴリ              | 機能名                       | 技術/ライブラリ                     | 詳細仕様                                                                                                                                                                                                                                        |
| :-------------------- | :--------------------------- | :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **A. 音声認識 (ASR)** | **リアルタイム音声認識**     | `nodejs-whisper` 系 (バイナリ実行)  | 1. **VAD (無音検知):** `@ricky0123/vad-web` 等で発話区間のみを検出し、Whisper (CPU) の無駄な処理を抑制する。<br>2. **処理:** 音声認識のみローカルで実行 (`whisper-cli.exe` spawn)。<br>3. **モデル:** 軽量な `tiny` / `base` 量子化モデル推奨。 |
| **B. 翻訳 (LLM)**     | **マルチプロバイダー翻訳**     | **Groq API** / **OpenAI API Protocol** (Ollama, LM Studio等) | 1. **柔軟性:** OpenAI SDK を採用し、Groq だけでなく OpenAI (本家) や ローカル LLM (Ollama) にも対応。<br>2. **モデル:** 高速推論 LPU 上の `Llama-3.3-70b` や、ローカルの `Qwen2.5` 等を選択可能。<br>3. **処理:** 入力言語を自動判定し、対になる言語へ翻訳（日 → 韓、韓 → 日）。 |
| **C. フィルタリング** | **スラング・プロンプト制御** | システムプロンプト                  | 1. **口調:** 翻訳先言語のゲーマー・スラング（例: `ㅋㅋㅋ`, `草`, `GG`など）を積極的に使用。<br>2. **制御:** 直訳を避け、フランクな会話調に変換するようプロンプトで指示。                                                                        |
| **D. 外部連携**       | **オーバーレイ配信**             | **Express + Socket.IO**               | 1. 翻訳確定結果をリアルタイムでオーバーレイページへ配信。<br>2. OBSのブラウザソースや通常のウェブブラウザからアクセス可能。                                                                                     |
| **E. ログ出力**       | **開発・運用ログ**           | Node.js 処理                        | 1. **出力形式:** 処理結果（ASR、翻訳）およびエラーをログファイルへ書き出す。                                                                                                                                                      |

---

## 🖥 II. フロントエンド (Electron / UI) 仕様

### 1. 技術選定とインターフェース

| 項目         | 技術/方式                                  | 詳細仕様                                                                                                                                                                                                                                                |
| :----------- | :----------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **技術選定** | **Electron Forge** + **Vite** + **React** |  高速な開発サイクル (HMR) とリアクティブな UI 構築を実現。                                                                                                                                                                               |
| **デザイン** | **Tailwind CSS** (+ DaisyUI)               |  ゲーマー向けのダークテーマ、ネオン等のリッチな UI を効率的に構築する。                                                                                                                                                                  |
| **通信 IF**  | **IPC** (Inter-Process Communication)      | 1. **基本:** Electron 標準の **IPC** を使用し、低遅延で双方向の通信を実現。<br>2. **抽象化:** バックエンド・フロントエンド間で **`ITransportSender`** のような抽象レイヤーを定義し、IPC の実装をカプセル化。将来的な WebSocket/Tauri への移行に備える。 |

### 2. UI 機能一覧

| カテゴリ          | 機能名                   | 詳細                                                                                                                                                                  |
| :---------------- | :----------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **A. 設定 UI**    | **API・モデル設定**      | 1. **Groq API Key:** ユーザー自身の API キー入力欄。<br>2. **モデル選択:** `llama-3.3-70b` などをプルダウン選択。<br>3. **翻訳方向:** 自動判定 / 固定設定の切り替え。 |
| **B. ステータス** | **リアルタイム状態表示** | 1. Whisperサーバー稼働状態 / オーバーレイサーバー稼働状態を可視化。                                                                                                       |
| **C. ログビュー** | **開発者向けログ**       | 1. 音声入力/チャット受信 → 翻訳結果を **VoiceLogComponent** 等でリアルタイム表示。<br>2. 双方向翻訳の流れ（JA->KO, KO->JA）をわかりやすく表示。                       |

---

## 🔗 III. システム・インターフェース概要

### 1. 抽象化の採用ポイント

| 抽象化対象       | 目的                                                                     | 実装する抽象インターフェース             |
| :--------------- | :----------------------------------------------------------------------- | :--------------------------------------- |
| **通信方式**     | Electron 以外の環境への移行を容易にする。                                | `ITransportSender` (IPC or WebSocket)    |
| **チャット取得** | YouTube の仕様変更リスクに対応し、API へ即座に切り替えられるようにする。 | `IChatSource` (Scraping or Official API) |
